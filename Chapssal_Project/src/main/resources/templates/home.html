<!DOCTYPE html>
<html layout:decorate="~{layout}">
	<head>
	    <style>
	        .video-list {
	            display: flex;
	            flex-direction: column;
	        }
	
			.video-item {
			    display: flex;
			    flex-direction: column;
			    align-items: center;
			    position: relative; /* 버튼을 영상 오른쪽에 배치하기 위해 필요한 스타일 */
			}
	
	        .video-container {
	            position: relative;
	            width: 9%; /* 화면의 36% 너비 설정 */
				min-width: 450px;
				min-height: 650px;
	            padding-bottom: 16%; /* 9:16 비율 (16 / 9 * 36) */
	            background-color: black; /* 영상이 없는 부분을 검게 표시 */
	            overflow: hidden;
	            border-radius: 10px; /* 비디오 테두리를 둥글게 만듦 */
				position: relative;
	        }
	
	        .video-container video {
	            position: absolute;
	            top: 50%;
	            left: 50%;
	            width: 100%;
	            height: 100%;
	            transform: translate(-50%, -50%);
	        }

			.video-buttons {
			    position: absolute;
			    top: 55%;
			    left: 69%;
			    display: flex;
			    flex-direction: column;
			}

			.action-btn {
			    background-color: rgba(0, 0, 0, 0.1);
			    border: none;
			    color: black;
			    border-radius: 50%;
			    width: 50px;
			    height: 50px;
			    display: flex;
			    align-items: center;
			    justify-content: center;
			    cursor: pointer;
			}
				
	        .video-content {
	            font-size: 14px;
	            text-align: left;
	            width: 45%;
				min-width: 576px;
	        }
			
			.video-content .col-5,
	        .video-content .col-35,
	        .video-content .col-5 {
	            flex: 1;
	        }
			
			.video-content .col-35 {
	            flex: 7;
	            display: flex;
	            flex-direction: column;
	            justify-content: flex-start;
	        }

	        .video-content img {
	            width: 100%;
	            height: auto;
	            border-radius: 50%;
	        }
	
	        .video-content p {
	            margin: 0;
	        }
			
			.follow-btn {
			    width: 100%;
			    padding: 5px 0;
			    font-size: 14px;
			    background-color: #007bff;
			    border: none;
			    color: white;
			    border-radius: 5px;
			    cursor: pointer;
			}

			.follow-btn:hover {
			    background-color: #0056b3;
			}
			
			.nav-center {
			    display: flex;
			    justify-content: center;
			    align-items: center;
			}

			.home-nav-link {
			    background-color: rgb(100, 100, 100, 0.1);
			    color: black;
				width: 108px;
				height: 40px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				font-size: 15px;
			}

			.home-nav-link.active {
			    background-color: black !important;
			    color: white !important;
			}
			
			.video-btn-count{
				display: flex;
				justify-content: center;
				align-items: center;
				font-size: 12px;
			}
	    </style>
	</head>
	<body>
		<div layout:fragment="content" class="container">
		    <nav class="container nav-center p-0">
		        <div class="nav nav-pills center" id="nav-tab" role="tablist">
		            <button class="nav-link home-nav-link active mx-1 py-1" id="nav-all-tab" data-bs-toggle="pill" data-bs-target="#nav-all" type="button" role="tab" aria-controls="nav-all" aria-selected="true">전체</button>
		            <button class="nav-link home-nav-link mx-1 p-0" th:each="topic : ${topicsByVoteCount}" th:id="'nav-' + ${topic[0].topicNum} + '-tab'" data-bs-toggle="pill" th:data-bs-target="'#nav-' + ${topic[0].topicNum}" type="button" role="tab" th:aria-controls="'nav-' + ${topic[0].topicNum}" aria-selected="false" th:text="${topic[0].title}"></button>
				</div>
		    </nav>
			<br>
			<br>
			<div class="tab-content" id="nav-tabContent">
				<!-- 전체 탭에서 비디오를 출력하는 부분 -->
				<div class="tab-pane fade show active" id="nav-all" role="tabpanel" aria-labelledby="nav-all-tab" tabindex="0">
					<div class="video-list">
					    <div th:if="${videos != null}">
					        <div th:each="videoData : ${videos}" class="video-item">
					            <div class="video-content">
					                <div class="row">
					                    <div class="col-5">
					                        <img th:src="${videoData.video.user.profilePictureUrl != null ? videoData.video.user.profilePictureUrl : '/images/default_profile.png'}" alt="프로필 사진" class="rounded-circle profile-pic">
					                    </div>
					                    <div class="col-35 p-0">
					                        <p th:text="${videoData.video.user.userName}"></p>
					                        <p th:text="${videoData.video.title}"></p>
					                    </div>
					                    <div class="col-5">
					                        <button class="follow-btn">팔로우</button>
					                    </div>
					                </div>
					            </div>
					            <br>
					            <div class="video-container" th:onclick="'showModal(this)'" th:data-video-id="${videoData.video.videoNum}" th:data-title="${videoData.video.title}" th:data-username="${videoData.video.user.userName}" th:data-views="${videoData.video.viewCount}" th:data-videourl="${videoData.video.videoUrl}">
					                <video controls autoplay muted>
					                    <source th:src="@{${videoData.video.videoUrl}}" type="video/mp4">
					                    Your browser does not support the video tag.
					                </video>
					            </div>
					            <div class="video-buttons">
					                <button class="action-btn"><i class="bi bi-heart-fill"></i></button>
					                <p class="video-btn-count m-0" th:text="${videoData.likeCount}"></p>
					                <button class="action-btn modal-open"><i class="bi bi-chat-dots-fill"></i></button>
					                <p class="video-btn-count m-0" th:text="${videoData.commentCount}"></p>
					                <button class="action-btn"><i class="bi bi-bookmark-fill"></i></button>
					                <p class="video-btn-count m-0">362</p>
					                <button class="action-btn"><i class="bi bi-share-fill"></i></button>
					                <p class="video-btn-count m-0">228</p>
					            </div>
					            <br>
					            <hr style="width: 700px;">
					            <br>
					        </div>
					    </div>
					    <div th:if="${videos == null}">
					        <p>비디오가 없습니다. 비디오를 업로드해주세요.</p>
					    </div>
					</div>
				</div>
				
				<!-- 각 주제별 탭에서 비디오를 출력하는 부분 -->
				<div th:each="topic : ${topicsByVoteCount}" th:id="'nav-' + ${topic[0].topicNum}" class="tab-pane fade" role="tabpanel" th:aria-labelledby="'nav-' + ${topic[0].topicNum} + '-tab'" tabindex="0">
				    <div class="video-list">
				        <div th:each="videoData : ${videos}" th:if="${videoData.video.topic != null and videoData.video.topic == topic[0].topicNum}" class="video-item">
				            <div class="video-content">
				                <div class="row">
				                    <div class="col-5">
				                        <img th:src="${videoData.video.user.profilePictureUrl != null ? videoData.video.user.profilePictureUrl : '/images/default_profile.png'}" alt="프로필 사진" class="rounded-circle profile-pic">
				                    </div>
				                    <div class="col-35 p-0">
				                        <p th:text="${videoData.video.user.userName}"></p>
				                        <p th:text="${videoData.video.title}"></p>
				                    </div>
				                    <div class="col-5">
				                        <button class="follow-btn">팔로우</button>
				                    </div>
				                </div>
				            </div>
				            <br>
				            <div class="video-container"  th:data-video-id="${videoData.video.videoNum}" th:data-title="${videoData.video.title}" th:data-username="${videoData.video.user.userName}" th:data-views="${videoData.video.viewCount}" th:data-videourl="${videoData.video.videoUrl}">
				                <video controls autoplay muted>
				                    <source th:src="@{${videoData.video.videoUrl}}" type="video/mp4">
				                    Your browser does not support the video tag.
				                </video>
				            </div>
				            <div class="video-buttons">
				                <button class="action-btn"><i class="bi bi-heart-fill"></i></button>
				                <p class="video-btn-count m-0" th:text="${videoData.likeCount}"></p>
				                <button class="action-btn modal-open"><i class="bi bi-chat-dots-fill"></i></button>
				                <p class="video-btn-count m-0" th:text="${videoData.commentCount}"></p>
				                <button class="action-btn"><i class="bi bi-bookmark-fill"></i></button>
				                <p class="video-btn-count m-0">187</p>
				                <button class="action-btn"><i class="bi bi-share-fill"></i></button>
				                <p class="video-btn-count m-0">461</p>
				            </div>
				            <br>
				            <hr style="width: 700px;">
				            <br>
				        </div>
				    </div>
				</div>
			</div>
		</div>
	    
	    <!-- 홈 스크립트 -->
	    <th:block th:fragment="homeVideoScript">
	        <script>
				function styleSpecialChars(text) {
				    return text.replace(/#(\S+)/g, '<strong>#$1</strong>')
				               .replace(/@(\S+)/g, '<strong>@$1</strong>');
				}
				
	        </script>
	    </th:block>
	</body>
</html>
